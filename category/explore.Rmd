---
layout: category
title: Explore
output:
  html_document:
    keep_md: true
---
[Home](/ACC)

Histograms summarizing chromosomal counts (i.e., distribution of haploid counts, N) by taxonomic level can be found below. To select target lineage, type taxonomic information or select using drop-down menu.

#### Note: Haploid counts are based on inferred N (2N/2) with decimal numbers rounded up.


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)
library(stringr)
library(bsselectR)
library(tidyverse)

getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}


##This function can be used to plot line plots for chromosome counts (similar to
##the one in the main text). I'm not using it right now
Plot_CC_distribution<-function(db=NULL, span=3,freqY=2, freqX=2, addY=5, addX=0,sizeT=3,annotations=annotations, color="black"){
  
  counts<-na.omit(as.numeric(unlist(lapply(seq_along(db), function(x) strsplit(as.character(db[x]),',')))))
  cond<-as.data.frame(table(counts))
  
  ##Need to fill missing numbers with 0
  expected<-seq(1,max(as.numeric(as.character(cond$counts))))
  "%!in%" = Negate("%in%")
  
  missing<-cbind.data.frame(expected[which(expected %!in% as.character(cond$counts))],0)
  names(missing)<-c("counts", "Freq"  )
  names(cond)
  cond<-rbind(missing,cond)
  
  custom_breaksx <- seq(0, max(as.numeric(cond$counts)), freqX)
  custom_breaksy <- seq(0, c(max(as.numeric(as.character(cond$Freq)))), freqY)
  
  every_nth <- function(x, nth, empty = TRUE, inverse = FALSE){
    if (!inverse) {
      if(empty) {
        x[1:nth == 1] <- ""
        x
      } else {
        x[1:nth != 1]
      }
    } else {
      if(empty) {
        x[1:nth != 1] <- ""
        x
      } else {
        x[1:nth == 1]
      }
    }
  }
  
  p<-ggplot(cond, aes(x = as.numeric(counts), y = Freq, group = 1)) + geom_line(color=color) + 
    #stat_peaks(colour = "black") +
    #stat_peaks(geom = "text", colour = "black", vjust = -0.5,span = span)+
    theme_bw() +
    theme(axis.line = element_line(colour = "black"),
          panel.grid.major = element_blank(),
          panel.grid.minor = element_blank(),
          panel.border = element_blank(),
          panel.background = element_blank()) + 
    scale_x_continuous(breaks = custom_breaksx,
                       labels = every_nth(custom_breaksx, 4, inverse = TRUE),
                       expand = c(0, 0), limits = c(0,max(as.numeric(as.character(cond$counts)))+addX)) + 
    scale_y_continuous(breaks = custom_breaksy,
                       labels = every_nth(custom_breaksy, 4, inverse = TRUE),
                       expand = c(0, 0), limits = c(0,max(as.numeric(cond$Freq))+addY))+
    labs(title="",  x ="Haploid Chromosome #", y = "Number of species") + 
    theme(text=element_text(size=13,  family="Times New Roman"))+
    geom_text(data=annotations,aes(x=xpos,y=ypos,hjust=hjustvar,vjust=vjustvar,label=annotateText),  size=sizeT)+ geom_line(color=color)
  
  p
  
}


df <- read.csv("ACCDB_Dec2.csv")
levels_target<- colnames(df)[1:7]

plots_CC<-function(y){
resulting_ds_level<-df[, c("curated_roundup_N",  levels_target[y] ),]
colnames(resulting_ds_level)<-c("Count", "Level")
resulting_ds_level$Count<-as.character(resulting_ds_level$Count)
total_levels<-sort(unique(as.vector( resulting_ds_level$Level  )))
total_levels<-total_levels[!total_levels %in% c("Catenulida", "")]

plots <- lapply(seq_along(total_levels), function(x) {
  
  state = filter(resulting_ds_level, Level == total_levels[x])
  counts<-data.frame("counts"=as.numeric(unlist(strsplit(state$Count, ","))))
  
  if( length(unique(counts[,1])) > 10 ){
    
    annotations <- data.frame(
  xpos = Inf,
  ypos =  Inf,
  annotateText = paste0(toupper(total_levels[x]),
                        "\n N=",length(counts$counts), 
                        "\n Species=", length(state$Count), 
                        "\n [0-100%]=", paste0(min(counts$counts),"-",max(counts$counts)),
                        "\n [25-75%]=", paste0(quantile(counts$counts)[c(2,4)], collapse = "-"),
                        "\n Median=", round(median(counts$counts)),
                        "\n Mean=", round(mean(counts$counts)),
                        "\n Mode=", round(getmode(counts$counts))
                        ),
  hjustvar = 1 ,
  vjustvar = 1)

p<- ggplot(counts, aes(counts)) +
  geom_histogram(aes(y = (..count..)/sum(..count..),
                     #fill = cut(counts, 5)
                     ),
                     show.legend = FALSE) +
  theme_minimal() +
  labs(x = "Haploid number (n)", y = "Frequency")+
  scale_fill_discrete(h = c(180, 360), c = 150, l = 80)+
  geom_text(data=annotations,aes(x=xpos,y=ypos,hjust=hjustvar,vjust=vjustvar,label=annotateText),  size=2)

p

    
  }
})

paths <- paste0(total_levels, "_", levels_target[y],".png")
dir.create("plots")
pwalk(list(paths, plots), ggsave, path = "plots", dpi = 300)
files_target<-list.files("plots", full.names = TRUE)
files_target<-files_target[grep(levels_target[y], files_target)]
state_plots <- paste0(files_target)
names(state_plots) <- str_replace_all(state_plots, 
                                      c("\\.png" = "", 
                                        "plots/" = ""))
names(state_plots) <- gsub("\\_.*","",names(state_plots))


bsselect(state_plots, type = "img", 
         live_search = TRUE, show_tick = TRUE, height = 10)
}

```


### Kingdom

Distribution of haploid numbers for *Animals*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(1)
```

### Phylum
Distribution of haploid numbers for different Animal *phyla*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(2)
```

### Class
Distribution of haploid numbers for different Animal *classes*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(3)
```

### Order
Distribution of haploid numbers for different Animal *orders*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(4)
```

### Family
Distribution of haploid numbers for different Animal *families*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(5)
```

### Genus
Distribution of haploid numbers for different Animal *genera*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(6)
```
  

[Home](/ACC)







