---
layout: category
title: Explore
output:
  html_document:
    keep_md: true
---
[Home](/ACC)

Below is a quick graphical explorer of the **ACC**. Chromosome count graphs can be retrieved for haploid (*N*) chromosome counts.Plots below are based on the inferred n (**2N**/2) with decimal numbers rounded up. Histograms are shown for lineages with more than 10 unique counts. 

Please type (or select) any target lineage under the corresponding drop-down menu. 


```{r echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(scales)
library(stringr)
library(bsselectR)
library(tidyverse)

getmode <- function(v) {
   uniqv <- unique(v)
   uniqv[which.max(tabulate(match(v, uniqv)))]
}


df <- read.csv("ACCDB_Dec2.csv")
levels_target<- colnames(df)[1:7]

plots_CC<-function(y){
resulting_ds_level<-df[, c("curated_roundup_N",  levels_target[y] ),]
colnames(resulting_ds_level)<-c("Count", "Level")
resulting_ds_level$Count<-as.character(resulting_ds_level$Count)
total_levels<-sort(unique(as.vector( resulting_ds_level$Level  )))
total_levels<-total_levels[!total_levels %in% c("Catenulida", "")]

plots <- lapply(seq_along(total_levels), function(x) {
  
  state = filter(resulting_ds_level, Level == total_levels[x])
  counts<-data.frame("counts"=as.numeric(unlist(strsplit(state$Count, ","))))
  
  if( length(unique(counts[,1])) > 10 ){
    
    annotations <- data.frame(
  xpos = Inf,
  ypos =  Inf,
  annotateText = paste0("N=",length(counts$counts), 
                        "\n Species=", length(state$Count), 
                        "\n [0-100%]=", paste0(min(counts$counts),"-",max(counts$counts)),
                        "\n [25-75%]=", paste0(quantile(counts$counts)[c(2,4)], collapse = "-"),
                        "\n Median=", round(median(counts$counts)),
                        "\n Mean=", round(mean(counts$counts)),
                        "\n Mode=", round(getmode(counts$counts))
                        ),
  hjustvar = 1 ,
  vjustvar = 1)

p<- ggplot(counts, aes(counts)) +
  geom_histogram(aes(y = (..count..)/sum(..count..),
                     fill = cut(counts, 5)),show.legend = FALSE) +
  theme_minimal() +
  labs(x = "Haploid number (n)", y = "Frequency")+
  scale_fill_discrete(h = c(180, 360), c = 150, l = 80)+
  geom_text(data=annotations,aes(x=xpos,y=ypos,hjust=hjustvar,vjust=vjustvar,label=annotateText),  size=3)

p

    
  }
})

paths <- paste0(total_levels, "_", levels_target[y],".png")
dir.create("plots")
pwalk(list(paths, plots), ggsave, path = "plots", dpi = 300)
files_target<-list.files("plots", full.names = TRUE)
files_target<-files_target[grep(levels_target[y], files_target)]
state_plots <- paste0(files_target)
names(state_plots) <- str_replace_all(state_plots, 
                                      c("\\.png" = "", 
                                        "plots/" = ""))
names(state_plots) <- gsub("\\_.*","",names(state_plots))


bsselect(state_plots, type = "img", 
         live_search = TRUE, show_tick = TRUE, height = 10)
}

```


### Kingdom

Distribution of haploid numbers for *Animals*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(1)
```

### Phylum
Distribution of haploid numbers for different Animal *phyla*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(2)
```

### Class
Distribution of haploid numbers for different Animal *classes*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(3)
```

### Order
Distribution of haploid numbers for different Animal *orders*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(4)
```

### Family
Distribution of haploid numbers for different Animal *families*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(5)
```

### Genus
Distribution of haploid numbers for different Animal *genera*.  

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.height=3, fig.width=4}
plots_CC(6)
```
  

[Home](/ACC)







